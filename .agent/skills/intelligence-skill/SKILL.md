---
name: intelligence-skill
description: 江湖情报系统，负责每日情报生成、更新与支线任务触发机制。
---

# 江湖情报系统 (Intelligence System)

## 概述
情报系统是江湖的耳目，每日随时间流逝自动生成新的江湖动态。它是连接世界动态与玩家选择的桥梁，通过情报引导玩家发现支线任务、隐藏奇遇和世界观深层次内容。

## 核心职责
1. **情报生成**：根据时间推进自动生成各类江湖情报
2. **情报管理**：维护情报数据库，记录过期情报和活跃情报
3. **支线触发**：通过情报揭露支线任务入口，引导玩家探索
4. **时效控制**：管理情报的有效期，确保情报的新鲜度和相关性

## 1. 情报类型分类

### 1.1 门派动态 (Sect Movements)
- **定义**：各门派的新动向、人事变动、争端
- **示例**："少林寺近日收了一名异域弟子"、"天剑山庄与神殿开始暗中交易"
- **触发条件**：随机生成

### 1.2 江湖传闻 (Rumors)
- **定义**：酒肆茶馆流传的未经验证的消息
- **示例**："南疆出现了一位毒术高明的怪人"、"白马居附近频发野兽失踪"
- **触发条件**：随机生成，真实性需验证

### 1.3 神秘事件 (Mysteries)
- **定义**：超自然或难以解释的现象
- **示例**："极北雪域现极光异象"、"漱玉矶深夜传来古怪声响"
- **触发条件**：特定时间或地点触发

### 1.4 人物行踪 (Figure Whereabouts)
- **定义**：重要 NPC 的动态或行踪
- **示例**："丐帮帮主现身大研镇"、"百晓生被目击在丈人村采药"
- **触发条件**：基于 NPC AI 行为

### 1.5 宝物线索 (Treasure Clues)
- **定义**：武功秘籍、神兵利器、珍稀材料的线索
- **示例**："传闻地下埋藏着上古神兵"、"雪山发现千年雪莲"
- **触发条件**：玩家等级、特定地点触发

## 2. 情报等级划分

| 等级 | 优先级 | 展示方式 | 触发后果 |
| :--- | :--- | :--- | :--- |
| **普通** | 1 | 正常显示 | 一般背景信息 |
| **重要** | 2 | 标记【重要】 | 可触发支线任务 |
| **机密** | 3 | 标记【机密】 | 影响势力关系 |
| **传说** | 4 | 标记【传说】 | 引发主线剧情 |

**展示优先级**：传说 > 机密 > 重要 > 普通

## 3. 时间系统集成

### 3.1 每日更新机制
- **触发时间**：每日卯时（日出）更新情报
- **更新流程**：
  1. 自动生成 3-6 条新情报
  2. 过期情报标记为已失效
  3. 检查是否需要触发特殊事件

### 3.2 时间敏感性
- 部分情报有时效性，过期后不再可用
- 情报有效期在生成时确定（1-7 天不等）
- 传说级情报永久有效

## 4. 情报生成规则

### 4.1 生成权重
- **门派动态**：30%
- **江湖传闻**：25%
- **神秘事件**：15%
- **人物行踪**：15%
- **宝物线索**：15%

### 4.2 稀有度控制
- 每日最多生成 1 条机密情报
- 每 3 天最多生成 1 条传说情报
- 基于玩家等级调整难度分配

### 4.3 地域相关性
- 生成的情报应与玩家当前位置相关
- 距离越近，情报权重越高
- 支持跨地域的宏观情报

## 5. 支线任务触发机制

### 5.1 触发条件
情报可以通过以下路径触发支线任务：
1. **选择情报详情**：玩家选择查看某条情报详情后触发
2. **特定关键词**：情报内容包含触发词（如"传说"、"秘籍"）
3. **情报等级**：重要或更高级别的情报可触发支线

### 5.2 触发流程
1. 玩家收到每日情报列表
2. 选择感兴趣的情报查看详情
3. 系统提示是否接受相关支线任务
4. 确认后调用 `quest-skill` 创建新任务

### 5.3 与 Quest 系统交互
- 使用命令：`python .agent/skills/quest-skill/scripts/quest_manager.py --add "任务名" --category "Side" --desc "任务描述" --relations "相关信息"`
- 情报任务的关系字段需填写情报 ID 号

## 6. 与其他系统交互

### 6.1 World-Logic 系统
- 获取当前时间（用于判断更新时机）
- 获取玩家位置（用于生成地域相关情报）
- 获取门派势力状态（影响门派动态情报内容）

### 6.2 NPC-Skill 系统
- 获取 NPC 状态（用于生成人物行踪情报）
- 更新 NPC 好感度（情报触发的任务可能影响）

### 6.3 Quest-Skill 系统
- 创建情报相关的支线任务
- 更新任务状态反映情报验证结果

### 6.4 Item-Skill 系统
- 宝物线索情报可关联物品数据库
- 支线完成后奖励物品

## 7. 交互协议

### 7.1 加载情报系统
每次涉及情报时，必须先读取：
- `references/intelligence_database.md`：获取当前可用情报
- `scripts/intelligence_manager.py`：调用管理函数

### 7.2 每日情报更新调用
```bash
python .agent/skills/intelligence-skill/scripts/intelligence_manager.py --update_daily
```

### 7.3 情报查询调用
```bash
# 查询今日所有情报
python .agent/skills/intelligence-skill/scripts/intelligence_manager.py --list

# 查询特定情报详情
python .agent/skills/intelligence-skill/scripts/intelligence_manager.py --show [情报ID]
```

### 7.4 创建情报任务调用
```bash
python .agent/skills/quest-skill/scripts/quest_manager.py --add "任务名" --category "Side" --desc "任务描述" --relations "情报ID:[情报ID]"
```

## 8. 情报数据格式

每条情报包含以下字段：
- **ID**：唯一标识符（格式：INT-YYYYMMDD-NNN）
- **类型**：门派动态 / 江湖传闻 / 神秘事件 / 人物行踪 / 宝物线索
- **等级**：普通 / 重要 / 机密 / 传说
- **内容**：简短描述（用于列表展示）
- **详情**：完整描述（查看详情时展示）
- **有效期**：生成日期 + 持续天数
- **地域**：关联位置（可选）
- **状态**：活跃 / 已失效 / 已验证 / 已验证为假
- **关联任务**：若已触发支线，标注任务ID

## 资源参考
- [情报数据库](references/intelligence_database.md)
- [情报管理脚本](scripts/intelligence_manager.py)
